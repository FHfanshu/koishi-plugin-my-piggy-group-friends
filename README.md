# koishi-plugin-my-pig-group-friends

[![npm](https://img.shields.io/npm/v/koishi-plugin-my-pig-group-friends?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-my-pig-group-friends)

**çŒªé†’** - è™šæ‹Ÿæ—…è¡Œæ‰“å¡æ’ä»¶ï¼Œè®©ä½ çš„çŒªçŒªç¾¤å‹ç¯æ¸¸ä¸–ç•Œã€‚

> ä½ ç¾¤é‡Œæœ‰æ²¡æœ‰é‚£ç§ä½œæ¯æ··ä¹±ã€æ—¥å¤œé¢ å€’çš„çŒªçŒªæœ‹å‹ï¼Ÿç°åœ¨ï¼Œæ¯å½“ä»–ä»¬åœ¨å¥‡æ€ªçš„æ—¶é—´å†’æ³¡ï¼Œå°±é€ä»–ä»¬å»ä¸–ç•Œå„åœ°"æ—…è¡Œ"å§ï¼

## åŠŸèƒ½äº®ç‚¹

- **è™šæ‹Ÿæ—…è¡Œæ‰“å¡** - ç”Ÿæˆç²¾ç¾æ¯›ç»ç’ƒæ•ˆæœè¶³è¿¹å¡ç‰‡ï¼Œè®°å½•çŒªçŒªçš„ç¯çƒä¹‹æ—…
- **æ™ºèƒ½æ—¥å‡ºé€‰ç‚¹** - LLM ä¼šæ ¹æ®å½“å‰æ—¶é—´ï¼Œé€‰æ‹©æ­£åœ¨è¿æ¥æ—¥å‡ºçš„åœ°åŒºä½œä¸ºç›®çš„åœ°ï¼ˆæ¯•ç«Ÿæ˜¯"çŒªé†’"å˜›ï¼‰
- **é«˜è´¨é‡é£æ™¯å›¾** - é›†æˆ Unsplash / Pexels APIï¼Œè·å–ç›®çš„åœ°çœŸå®é£æ™¯ç…§ç‰‡
- **AI ç”Ÿå›¾æ”¯æŒ** - å¯é€‰ç”Ÿæˆå°çŒªåœ¨å½“åœ°æ—…è¡Œçš„ AI æ’ç”»
- **ä½œæ¯å¼‚å¸¸æ£€æµ‹ï¼ˆå®éªŒæ€§ï¼‰** - è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·æ¯æ—¥é¦–æ¡æ¶ˆæ¯æ—¶é—´ï¼Œåˆ¤æ–­ä½œæ¯æ˜¯å¦å¼‚å¸¸
- **ä¸–ç•Œè¶³è¿¹åœ°å›¾** - ç”Ÿæˆç”¨æˆ·å…¨çƒå›½å®¶è¶³è¿¹åœ°å›¾ä¸Topç›®çš„åœ°ç»Ÿè®¡

## æ•ˆæœé¢„è§ˆ

å½“è§¦å‘æ—…è¡Œæ—¶ï¼Œä¼šç”Ÿæˆç±»ä¼¼è¿™æ ·çš„å¡ç‰‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ç›®çš„åœ°é£æ™¯ç…§ç‰‡èƒŒæ™¯]        â”‚
â”‚                             â”‚
â”‚  ğŸ· xxx çŒªé†’ï¼              â”‚
â”‚                             â”‚
â”‚  å»äº† å†°å²›è“æ¹–æ¸©æ³‰ï¼Œå†°å²›ï¼   â”‚
â”‚                             â”‚
â”‚  2024-01-15 06:32           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®‰è£…

```bash
npm install koishi-plugin-my-pig-group-friends
```

## ä¾èµ–

### å¿…éœ€
- `database` - å­˜å‚¨ç”¨æˆ·çŠ¶æ€å’Œæ—…è¡Œæ—¥å¿—
- `cron` - å®šæ—¶æ¸…ç†ä»»åŠ¡
- `puppeteer` - æ¸²æŸ“ç²¾ç¾å¡ç‰‡

### å¯é€‰
- `chatluna` - LLM åŠ¨æ€ç”Ÿæˆæ—…è¡Œåœ°ç‚¹ï¼ˆæ¨èï¼‰
- `chatluna_storage` - é«˜æ•ˆç®¡ç†å›¾ç‰‡ç¼“å­˜
- `media-luna` - AI ç»˜å›¾åŠŸèƒ½

## ä½¿ç”¨æ–¹æ³•

### æŒ‡ä»¤

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `pig` | é€è‡ªå·±å»æ—…è¡Œ |
| `pig @æŸäºº` | é€æŒ‡å®šç”¨æˆ·å»æ—…è¡Œ |
| `çŒªé†’` | `pig` çš„åˆ«å |
| `pig.map` | æŸ¥çœ‹è‡ªå·±çš„ä¸–ç•Œè¶³è¿¹åœ°å›¾ |
| `pig.map @æŸäºº` | æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä¸–ç•Œè¶³è¿¹åœ°å›¾ |
| `ä¸–ç•Œè¶³è¿¹` | `pig.map` çš„åˆ«å |

### ç¤ºä¾‹

```
> çŒªé†’ @å¼ ä¸‰
ğŸ· å¼ ä¸‰ çŒªé†’ï¼å»äº† æŒªå¨ç½—å¼—æ•¦ç¾¤å²›ï¼ŒæŒªå¨ï¼
[ç²¾ç¾å¡ç‰‡å›¾ç‰‡]
```

## é…ç½®è¯´æ˜

### æœ€å°å¯ç”¨é…ç½®ï¼ˆç¤ºä¾‹ï¼‰

```yaml
my-pig-group-friends:
  outputMode: image
  travelMessageTemplate: å»äº† {landmark}ï¼Œ{country}ï¼ğŸ“¸
  llmLocationEnabled: false
  worldMapUseTianditu: false
  worldMapOfficialOnly: false
  monthlySummaryEnabled: false
  monthlySummaryScope: global
  debug: false
```

### è¿›é˜¶é…ç½®ï¼ˆç¤ºä¾‹ï¼‰

```yaml
my-pig-group-friends:
  outputMode: image
  travelMessageTemplate: å»äº† {landmark}ï¼Œ{country}ï¼ğŸ“¸

  llmLocationEnabled: true
  llmLocationModel: your-provider/your-model
  llmLocationCustomContext: åå¥½åŒ—æ¬§å’Œå°ä¼—è‡ªç„¶æ™¯è§‚
  llmFailureCooldownMs: 300000
  imageSearchPrompt: '{landmark} {country} landscape'
  unsplashAccessKey: ''
  pexelsApiKey: ''

  backgroundFetchMode: auto
  backgroundFetchTimeoutMs: 8000
  backgroundInlineMaxBytes: 8388608
  backgroundStoragePath: ./data/pig/backgrounds

  worldMapUseTianditu: true
  tiandituToken: ''
  tiandituTimeoutMs: 5000
  worldMapOfficialOnly: false

  aigcEnabled: false
  aigcChannel: ''
  aigcPrompt: ä¸€ä¸ªå¯çˆ±çš„å¡é€šå°çŒªæ­£åœ¨ {country} çš„ {landmark} å‰é¢è‡ªæ‹ï¼Œé˜³å…‰æ˜åªšï¼Œæ—…æ¸¸ç…§ç‰‡é£æ ¼

  experimentalAutoDetect: false
  experimentalAutoDetectScope: guild
  abnormalThreshold: 3
  defaultLat: 30
  defaultLng: 120

  silentRecordEnabled: true
  silentRecordAutoTravel: false

  nightOwlEnabled: true
  nightOwlStartHour: 0
  nightOwlEndHour: 5
  nightOwlGrayscaleAvatar: false

  useStorageService: true
  storageCacheHours: 24
  logRetentionDays: 45
  monthlySummaryEnabled: false
  monthlySummaryScope: global
  debug: false
```

### å¸¸æ˜¾é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `outputMode` | `image` | è¾“å‡ºæ¨¡å¼ï¼š`image` ç”Ÿæˆå¡ç‰‡ï¼Œ`text` çº¯æ–‡æœ¬ |
| `travelMessageTemplate` | `å»äº† {landmark}ï¼Œ{country}ï¼ğŸ“¸` | æ—…è¡Œæ¶ˆæ¯æ¨¡æ¿ |
| `backgroundFetchMode` | `auto` | èƒŒæ™¯å›¾æ‹‰å–ç­–ç•¥ï¼ˆauto/always/neverï¼‰ |
| `backgroundFetchTimeoutMs` | `8000` | èƒŒæ™¯å›¾æ‹‰å–è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰ |
| `backgroundInlineMaxBytes` | `8388608` | èƒŒæ™¯å›¾è½¬ data URL çš„æœ€å¤§å­—èŠ‚æ•° |
| `backgroundStoragePath` | `./data/pig/backgrounds` | è‡ªå®šä¹‰èƒŒæ™¯å›¾å­˜å‚¨è·¯å¾„ |
| `worldMapOfficialOnly` | `false` | ä»…å±•ç¤ºå®˜æ–¹åº•å›¾ï¼Œä¸åšå›½å®¶å¡«è‰²é«˜äº® |
| `defaultLat` | `30` | é»˜è®¤çº¬åº¦ï¼ˆç”¨äºæ—¥å‡ºç›¸å…³é€»è¾‘ï¼‰ |
| `defaultLng` | `120` | é»˜è®¤ç»åº¦ï¼ˆç”¨äºæ—¥å‡ºç›¸å…³é€»è¾‘ï¼‰ |
| `logRetentionDays` | `45` | æ—…è¡Œæ—¥å¿—ä¿ç•™å¤©æ•° |
| `monthlySummaryEnabled` | `false` | æ˜¯å¦å¯ç”¨æ¯æœˆè‡ªåŠ¨æ€»ç»“ï¼ˆä¸å½±å“æ‰‹åŠ¨ `pig.summary`ï¼‰ |
| `monthlySummaryScope` | `global` | æœˆåº¦æ€»ç»“èŒƒå›´ï¼š`global`/`guild` |
| `debug` | `false` | è¾“å‡ºè¯¦ç»†è°ƒè¯•æ—¥å¿— |

### æŒ‰å¼€å…³æ˜¾ç¤ºçš„é…ç½®é¡¹

| å¼€å…³ | å­é¡¹ï¼ˆä»…å¼€å…³ä¸º `true` æ—¶æ˜¾ç¤ºï¼‰ |
|------|-------------------------------|
| `llmLocationEnabled` | `llmLocationModel`ã€`llmLocationCustomContext`ã€`llmFailureCooldownMs`ã€`imageSearchPrompt`ã€`unsplashAccessKey`ã€`pexelsApiKey` |
| `aigcEnabled` | `aigcChannel`ã€`aigcPrompt` |
| `worldMapUseTianditu` | `tiandituToken`ã€`tiandituTimeoutMs` |
| `experimentalAutoDetect` | `experimentalAutoDetectScope`ã€`abnormalThreshold` |
| `silentRecordEnabled` | `silentRecordAutoTravel` |
| `nightOwlEnabled` | `nightOwlStartHour`ã€`nightOwlEndHour`ã€`nightOwlGrayscaleAvatar` |
| `useStorageService` | `storageCacheHours` |

### åºŸå¼ƒå…¼å®¹å­—æ®µ

ä»¥ä¸‹å­—æ®µä»…å…¼å®¹æ—§é…ç½®ï¼Œå½“å‰ç‰ˆæœ¬å·²å¿½ç•¥ï¼Œåç»­ç‰ˆæœ¬å°†ç§»é™¤ï¼š

- `sunriseApi`
- `logPath`

## è·å– API å¯†é’¥

### Unsplashï¼ˆæ¨èï¼‰
1. è®¿é—® [Unsplash Developers](https://unsplash.com/developers)
2. åˆ›å»ºåº”ç”¨ï¼Œè·å– Access Key
3. å…è´¹é¢åº¦ï¼š50 æ¬¡/å°æ—¶

### Pexelsï¼ˆå¤‡ç”¨ï¼‰
1. è®¿é—® [Pexels API](https://www.pexels.com/api/)
2. æ³¨å†Œå¹¶è·å– API Key
3. å…è´¹é¢åº¦ï¼š200 æ¬¡/å°æ—¶

## License

MIT
